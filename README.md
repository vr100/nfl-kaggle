# nfl-kaggle
NFL Kaggle

Kaggle problem link:
https://www.kaggle.com/c/nfl-big-data-bowl-2021

### compute-tracking-stats.py

	python3 compute-tracking-stats.py --data_path <path-to-nfl-data-downloaded-from-kaggle> --output_path <output-folder-path> --br_path <br-data-folder-path>

*br-data-folder-path* is the ball receiver data folder generated by ***find-ball-receiver.py***

This script generates the stats for the defense team cornerbacks and the defendent closest to the ball receiver. These stats are later used for Gaussian Mixture Model clustering.

Reference paper - https://arxiv.org/abs/1906.11373 ("Unsupervised Methods for Identifying Pass Coverage Among Defensive Backs with NFL Player Tracking Data")

### find-ball-receiver.py

	python3 find-ball-receiver.py --data_path <path-to-nfl-data-downloaded-from-kaggle> --output_path <output-folder-path>

This scripts generates the predicted ball receiver and corresponding defendent(s) data. The script generates both csv and json files. Json files are for consumption of visualizer. Csv files are for consumption of other scripts in this repository.

The ball receiver is determined as follows:

* Consider the frame F when the pass is thrown. The ball location is found for frames F ... F+4
* Using linear regression, we fit the line of ball trajectory
* We find all the offense players close to the line of trajectory (<= 10 yards) at frame F. For each of these players, we compute the distance of the player from the ball at frame F. We repeat this for end frame F+4
* We find the difference between distance at frame F+4 (end_distance) and frame F (start_distance) for each of the chosen offense player. Then we ignore the players who is moving away from the ball. That is, the players whose diff < 0
* We compute the difference of ball positions at frame F+4 and frame F. Then for each chosen player, we compute the following

		abs(player_position_diff - ball_position_diff)

* The player with the least absolute computed value would be chosen as ball receiver by the following logic:

	* The *player_position_diff* gives the distance by which the ball moves towards the player
	* The *ball_position_diff* gives the distance by which the ball has travelled
	* When the difference between the above two values is minimum, we could assume that the respective player is the person whom the pass is aimed at

### generate-dataframes.py

	python3 generate-dataframes.py --data_path <path-to-nfl-data-downloaded-from-kaggle> --output_path <output-folder-path>

The script converts the csv data files to pickle format after normalizing the data. This script is ***deprecated***.

### get-cluster-helper.sh

	export data_path=<stats-folder-path>
	export output_path=<output-folder-path>
	export model_path=<gmm-model-folder-path>
	./get-cluster-helper.sh

This is a helper script for ***get-cluster.py***. It runs across various different configurations of gmm clustering.

* *stats-folder-path* is the output folder generated by ***compute-tracking-stats.py***
* *gmm-model-folder-path* is the output folder generated by ***run-gmm-helper.sh***

### get-cluster.py

	python3 get-cluster.py --data_path <stats-folder-path> --output_path <output-folder-path> --config_path <config-file-path> --gmm_path <gmm-model-path>

This script uses the given gmm model to generate the cluster information for the given stats data files

* *stats-folder-path* is the output folder generated by ***compute-tracking-stats.py***
* *config-file-path* is the config.json file generated by ***run-gmm.py***
* *gmm-model-path* is the gmm.joblib file generated by ***run-gmm.py***

### get-play-dataset.py

	python3 get-play-dataset.py --data_path <path-to-nfl-data-downloaded-from-kaggle> --output_path <output-folder-path>

This script generates the x, y files used by the ***visualize.py*** script for plotting. This script is ***deprecated***

### plot-helper.py

	python3 plot-helper.py --data_path <csv-file-path> --output_path <image-file-path>

This script visualizes the csv file as stacked bar plot and saves the generated image in the given path. This script is ***deprecated***

* *csv-file-path* is the csv file generated by ***visualize.py***

### rum-gmm-helper.sh

	export data_path=<stats-folder-path>
	export output_path=<output-folder-path>
	export config_path=<config-folder-path>
	./run-gmm-helper.sh

This is a helper script for ***rum-gmm.py***. It runs across various different configurations.

* *stats-folder-path* is the output folder generated by ***compute-tracking-stats.py***
* *config-folder-path* is the configuration folder. All the required sample configurations are available in the ***config-samples*** folder

### run-gmm.py

	python3 run-gmm.py --data_path <stats-folder-path> --output_path <output-folder-path> --config_path <config-file-path>

This script generates gmm clustering model for the given stats.

Reference paper - https://arxiv.org/abs/1906.11373 ("Unsupervised Methods for Identifying Pass Coverage Among Defensive Backs with NFL Player Tracking Data")

* *stats-folder-path* is the output folder generated by ***compute-tracking-stats.py***
* *config-file-path* is the configuration json file. Related sample configurations are available in the ***config-samples*** folder

### visualize.py

	python3 visualize.py --data_path <dataset-folder-path> --output_path <output-folder-path> --config_path <config-file-path>

This script generates plotted images for the given data files. It also generates csv files for further exploration using ***plot-helper.py***. This script is ***deprecated***

* *dataset-folder-path* is the dataset generated by ***get-play-dataset.py***
* *config-file-path* is a configuration file. Sample is available at ***config-samples/visualize-cfg.json.sample***
